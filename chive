#!/bin/bash

USER=$1

peeps() {
  i=$1
  if ping -W 1 -c 1 hive$i.cs.berkeley.edu &>/dev/null; then
    data=$(ssh $USER@hive$i.cs.berkeley.edu "w -h | wc -l")
    printf "Hive%02d: %02d\n" "$i" "$data"
  else
    printf "Hive%02d is down!\n" "$i"
  fi
}
export -f peeps
printf %s\\n {1..30} | xargs -n 1 -P 30 -I{} bash -c "peeps {}"
